<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>RealReport Print Preview</title>
        <link rel="shortcut icon" href="#" />

        <link href="css/preview.css" rel="stylesheet" />

        <!-- 리얼리포트 PDF 내보내기 라이브러리 설정 -->
        <script type="text/javascript" src="js/pdfkit.js"></script>

        <!-- 리얼리포트 양식&데이터 파일 정적으로 사용 -->
        <script type="text/javascript" src="datas/salary-data.js"></script>
        <script type="text/javascript" src="forms/salary.js"></script>

        <!-- 리얼리포트 라이브러리 설정 -->
        <link href="js/realreport/realreport.css" rel="stylesheet" />
        <script
            type="text/javascript"
            src="js/realreport/realreport.js"
        ></script>

        <!-- 리얼리포트 양식에 설정한 커스텀 폰트 로드 -->
        <link
            rel="preload"
            href="js/pdffonts/NanumGothic.otf"
            as="font"
            type="font/otf"
            crossorigin="anonymous"
        />
        <link
            rel="preload"
            href="js/pdffonts/NanumGothicBold.otf"
            as="font"
            type="font/otf"
            crossorigin="anonymous"
        />

        <!-- 리얼리포트 양식에 설정한 FontFamily 명으로 스타일 설정 -->
        <style>
            @font-face {
                font-family: NaunmGothic;
                src: url('js/pdffonts/NanumGothic.otf') format('opentype');
                font-weight: normal;
                font-style: normal;
                font-display: swap;
            }
            @font-face {
                font-family: NaunmGothic;
                src: url('js/pdffonts/NanumGothicBold.otf') format('opentype');
                font-weight: bold;
                font-style: normal;
                font-display: swap;
            }
        </style>
    </head>
    <body>
        <div class="root">
            <div class="container">
                <div class="main">
                    <div class="main-content">
                        <div class="preview-toolbar">
                            <div class="toolbar-scrolller">
                                <div class="toolbar-left">
                                    <div class="toolbar-items">
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickZoomOut10();"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-zoomout-png"
                                            ></div>
                                        </a>
                                        <input
                                            part="input"
                                            type="text"
                                            value="100%"
                                            id="inputZoomScale"
                                            aria-label="Zoom Scale"
                                        />
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickZoomIn10();"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-zoomin-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickZoom100();"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-100-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickFitToWidth();"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-fit-to-width-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickFitToHeight();"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-fit-to-height-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickFitToPage();"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-fit-to-page-png"
                                            ></div>
                                        </a>
                                    </div>
                                </div>
                                <div class="toolbar-center">
                                    <div class="toolbar-items">
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickFirstPage();"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-first-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickPrevPage();"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-prev-png"
                                            ></div>
                                        </a>
                                        <div class="toolbar-item">
                                            <input
                                                part="input"
                                                type="text"
                                                value="1"
                                                id="inputPageNumber"
                                                aria-label="Page number"
                                            />
                                            <span style="margin: 0 4px">/</span>
                                            <span
                                                style="margin: 0 4px"
                                                id="totalpage"
                                                >1</span
                                            >
                                        </div>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickNextPage();"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-next-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickLastPage();"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-last-png"
                                            ></div>
                                        </a>
                                    </div>
                                </div>
                                <div class="toolbar-right">
                                    <div class="toolbar-items">
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="printReport()"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-print-png"
                                            ></div>
                                        </a>
                                    </div>
                                    <span class="vertical-separator"></span>
                                    <div class="toolbar-items">
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickExportPdf();"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-pdf-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickExportDoc('docx');"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-docx-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickExportDoc('hwp');"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-hwp-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickExportDoc('pptx');"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-pptx-png"
                                            ></div>
                                        </a>
                                    </div>
                                    <span class="vertical-separator"></span>
                                    <div class="toolbar-items">
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickExportImage('png');"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-png-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickExportImage('jpeg');"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-jpeg-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickExportImage('gif');"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-gif-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickExportImage('tiff', 'g3');"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-tiffg3-png"
                                            ></div>
                                        </a>
                                        <a
                                            class="toolbar-icon-button"
                                            onclick="onClickExportImage('tiff', 'g4');"
                                        >
                                            <div
                                                class="toolbar-icon icon preview-tiffg4-png"
                                            ></div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="scroller">
                            <div id="realreport"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            // 아래 라이선스는 유효기간 2025년 9월 9일 까지 localhost, 127.0.0.1 또는 real-report.com 도메인에서 사용할 수 있는 라이선스 입니다.
            var realReportLic =
                'upVcPE+wPOn1V3OcjC3PuAUt7xtLcP5XVzS0GnpZwpnbdxrzWi3SH9lnNreNwRub/31bQcGrnP/Nq/NkIKx9AkkSD8KWTVlm9aI3507Qm2POAklYqFD9ZGXyjOMqbrgvr3+iyFPC2UvKqt1f0nYq0Fe/mONIYEy4CkGU/2dJ94leC1UWt2Y/gOPSfHZhPA2TCr/ODTGzdoYBrs4Ui2AU8g==';
            var containerId = 'realreport';
            var viewer;

            //--------------------------------------------------------------------------------------------------
            // public methods
            //--------------------------------------------------------------------------------------------------

            var clearReport = function () {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                delete viewer;
            };

            const setHtml = function (id, value, prefix, surfix) {
                if (id) {
                    const el = document.getElementById(id);
                    if (el) el.innerHTML = `${prefix}${value}${surfix}`;
                }
            };

            const setTotalPage = function (id) {
                if (viewer) {
                    setHtml(id, viewer.pageCount, '', '');
                }
            };

            var previewGridReport = function (grid, options) {
                clearReport();

                if (grid) {
                    viewer = new RealReport.GridReportViewer(
                        containerId,
                        grid,
                        options,
                    );
                }

                if (viewer) viewer.preview();

                setTimeout(() => {
                    setTotalPage('totalpage');
                    viewer.fitToWidth();
                }, 100);

                return viewer;
            };

            var previewReport = function (reports) {
                clearReport();
                if (Array.isArray(reports) && reports.length > 1) {
                    viewer = new RealReport.ReportCompositeViewer(
                        containerId,
                        reports,
                    );
                } else {
                    const previewInfo = reports[0];
                    viewer = new RealReport.ReportViewer(
                        containerId,
                        previewInfo.form,
                        previewInfo.dataSet,
                    );
                }

                // if (viewer) viewer.preview({id: containerId, async: true, pageMark: false, noScroll: true});
                const pageCallback = (ctx, page, pageNo) => {
                    console.log(`${pageNo} 페이지 미리보기 완료`);
                };

                const endCallback = (ctx, pages) => {
                    console.log('모든 페이지 미리보기 완료');
                    setTotalPage('totalpage');
                    setZoomScaleInputValue('inputZoomScale');
                    setPageInputValue('inputPageNumber');
                };

                if (viewer)
                    viewer.preview({
                        async: true,
                        pageMark: false,
                        noScroll: true,
                        callback: pageCallback,
                        endCallback,
                    });

                return viewer;
            };

            //--------------------------------------------------------------------------------------------------
            // 이벤트 핸들링
            //--------------------------------------------------------------------------------------------------

            const onClickZoom = (z) => {
                if (viewer) {
                    viewer.zoom = z;
                }
            };

            const onClickZoomIn10 = function () {
                if (viewer) {
                    viewer.zoomIn();
                    setZoomScaleInputValue('inputZoomScale');
                }
            };

            const onClickZoomOut10 = function () {
                if (viewer) {
                    viewer.zoomOut();
                    setZoomScaleInputValue('inputZoomScale');
                }
            };

            const onClickZoom100 = function () {
                if (viewer) {
                    viewer.zoom = 1;
                    setZoomScaleInputValue('inputZoomScale');
                }
            };

            const onClickFitToHeight = function () {
                if (viewer) {
                    viewer.fitToHeight();
                    setZoomScaleInputValue('inputZoomScale');
                }
            };

            const onClickFitToWidth = function () {
                if (viewer) {
                    viewer.fitToWidth();
                    setZoomScaleInputValue('inputZoomScale');
                }
            };

            const onClickFitToPage = function () {
                if (viewer) {
                    viewer.fitToPage();
                    setZoomScaleInputValue('inputZoomScale');
                }
            };

            const onClickFirstPage = function () {
                if (viewer) {
                    viewer.first();
                    setPageInputValue('inputPageNumber');
                }
            };

            const onClickLastPage = function () {
                if (viewer) {
                    viewer.last();
                    setPageInputValue('inputPageNumber');
                }
            };

            const onClickPrevPage = function () {
                if (viewer) {
                    viewer.prev();
                    setPageInputValue('inputPageNumber');
                }
            };

            const onClickNextPage = function () {
                if (viewer) {
                    viewer.next();
                    setPageInputValue('inputPageNumber');
                }
            };

            async function base64convert(url, split) {
                const data = await fetch(url);
                const blob = await data.blob();

                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(blob);
                    reader.onloadend = () => {
                        const base64data = reader.result;
                        resolve(split ? base64data.split(',')[1] : base64data);
                    };
                });
            }

            const onClickExportPdf = function () {
                base64convert('/js/pdffonts/NanumGothic.otf', true).then(
                    (regularFont) => {
                        base64convert(
                            '/js/pdffonts/NanumGothicBold.otf',
                            true,
                        ).then((boldFont) => {
                            const fonts = [
                                {
                                    name: 'regular',
                                    content: regularFont,
                                    style: 'normal',
                                    weight: 'normal',
                                },
                                {
                                    name: 'bold',
                                    content: boldFont,
                                    style: 'normal',
                                    weight: 'bold',
                                },
                            ];

                            if (viewer) {
                                viewer.exportPdf({
                                    fonts,
                                    filename: 'sample-report',
                                    preview: false,
                                });
                            }
                        });
                    },
                );
            };

            const onClickExportDoc = function (type) {
                if (viewer) {
                    viewer.exportDocument({ type });
                }
            };

            const onClickExportImage = function (type, encoding, fileName) {
                if (viewer) {
                    var options = { type };
                    if (encoding) options.tiff = { encoding };
                    if (fileName) options.fileName = fileName;
                    viewer.exportImage(options);
                }
            };

            const printReport = function () {
                viewer.print();
            };

            //--------------------------------------------------------------------------------------------------
            // private methods
            //--------------------------------------------------------------------------------------------------

            const zoom = document.getElementById('inputZoomScale');
            zoom.addEventListener('change', (e) => {
                let zoom = e.target.value;
                if (zoom.endsWith('%')) zoom = zoom.replace('%', '');
                if (!isNaN(zoom)) {
                    viewer.zoom = zoom / 100;
                    setZoomScaleInputValue('inputZoomScale');
                }
            });

            const page = document.getElementById('inputPageNumber');
            page.addEventListener('change', (e) => {
                const page = e.target.value;
                if (!isNaN(page)) {
                    viewer.page = page;
                    setPageInputValue('inputPageNumber');
                }
            });

            const setInputValue = function (id, value, prefix, surfix) {
                if (id) {
                    const input = document.getElementById(id);
                    if (input)
                        input.value = `${prefix || ''}${value}${surfix || ''}`;
                }
            };

            const setZoomScaleInputValue = function (id) {
                setInputValue(id, Math.trunc(viewer.zoom * 100), '', '%');
            };

            const setPageInputValue = function (id) {
                if (viewer) {
                    setInputValue(id, viewer.page);
                }
            };
        </script>
    </body>
</html>
