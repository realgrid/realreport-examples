<!DOCTYPE html>
<html>

<head>
    <title>그리드 리포트</title>
    <link href="/js/realgrid/realgrid-style.css" rel="stylesheet" />
    <script src="/js/realgrid/realgrid.2.5.4.min.js"></script>
    <script src="/js/realgrid/libs/jszip.min.js"></script>

    <link href='/js/realreport/realreport.css' rel='stylesheet' />
    <script type="text/javascript" src="/js/highcharts/highcharts.js"></script>
    <script type="text/javascript" src="/js/highcharts/highcharts-more.js"></script>
    <script type="text/javascript" src="/js/pdfkit.js"></script>
    <script type="text/javascript" src='/js/realreport/realreport.js'></script>
    
    <script defer src="./grid-fields.js"></script>
    <script defer src="./grid-columns.js"></script>
    <script defer src="./grid-data.js"></script>
    <script defer src="./grid-report-options.js"></script>
    <style>
        html {
            height: 100%;
        }

        body {
            height: 100%;
            margin: 0;
        }
        main {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }
        #realgrid {
            flex-grow: 1;
        }
        #realreport {
            flex-grow: 1;
        }
        .toolbar {
            margin: 10px;
            border-top: solic silver 1px;
        }
        .content {
            flex-grow: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 4px;
        }
        .hr {
            display: inline;
            border: 1px solid silver;
            margin: 0 10px;
        }
    </style>

    <script>
        /**
         * RealReport를 사용하기 위해 라이선스가 필요합니다. https://service.realgrid.com 에서 무료 라이선스를 발급 받을 수 있습니다.
         * - 아래 라이선스는 유효기간 2023년 1월 1일 까지 localhost, 127.0.0.1 또는 real-report.com 도메인에서 사용할 수 있는 라이선스 입니다.
         */
         var realReportLic = 'upVcPE+wPOkcfqywe+clVN+UVTCvO3is+83EYTz6U/sTXJR8Yw8Y0WXyjOMqbrgvr3+iyFPC2UvWntFnlQAvG/WiN+dO0JtjdX/TRvH17asONaYpJP0FO3omxwgpdzq2WOF5T6PZ/A5qH7VKQ7lvNfumRlcQ8Ue0';

        /**
         * RealGrid를 사용하기 위해 라이선스가 필요합니다. https://service.realgrid.com 에서 무료 라이선스를 발급 받을 수 있습니다.
         * - 아래 라이선스는 유효기간 2023년 1월 1일 까지 localhost,127.0.0.1,*.real-report.com,*.realgrid.com 도메인에서 사용할 수 있는 라이선스 입니다.
         */
         var realGrid2Lic = 'upVcPE+wPOmtLjqyBIh9RkM/nBOseBrflwxYpzGZyYm9cY8amGDkiMnVeQKUHJDjW2y71jtk+wv50juZqrKKzQ4npiZoGBKqiyNJFvlrikYx1/B3rwdT6DEb9aq2Rq6t14cSaKokEsKcOLcHLybNHw==';

        /**
         * 웹 페이지에 RealGrid와 RealReport 컴포넌트를 랜더링할 컨테이너가 필요합니다.
         * 아래 변수는 렌더링할 컨테이너의 Element를 보관할 변수 입니다.
         */
        var gridContainer, reportContainer;

        /**
         * RealGrid의 데이터를 관리할 LocalDataProvider객체를 위한 변수를 선언합니다.
         */
        var dataProvider;

        /**
         * RealGrid와 RealReport 컴포넌트를 위한 변수를 선언합니다.
         */
        var gridView, reportView;

        /**
         * 그리드와 리포트를 렌더링할 컨테이너 페이지가 로드된 다음 컨테이너 요소를 가져오기 위해
         * DOMContentLoaded 이벤트에서 작성합니다.
         */
        document.addEventListener('DOMContentLoaded', function () {
            /**
             * 버튼 1 ~ 15 클릭 핸들링
             * document.getElementById(`button{1~15}`).onclick = clickButton_{1~15}() ;
             */
            for (let i = 1; i <= 15; i++) {
                const button = document.getElementById(`button${i}`);
                button.onclick = new Function(`clickButton_${i}();`);
            }
        });

        /**
         * 필드, 컬럼, 데이터를 이용해 그리드를 구성하고,
         * 그리드의 데이터와 레이아웃으로 리포트를 출력합니다.
         */
        function setSample(fields, columns, data, options) {
            gridContainer = document.getElementById('realgrid');
            if (!dataProvider) {
                dataProvider = new RealGrid.LocalDataProvider();
                gridView = new RealGrid.GridView(gridContainer);
                gridView.setDataSource(dataProvider);
            }

            dataProvider.setFields(fields);
            gridView.setColumns(columns);
            dataProvider.fillJsonData(data, { fillMode: "set" });

            if (gridView) {
                reportContainer = document.getElementById('realreport');
                reportView = new RealReport.GridReportViewer(reportContainer, gridView, options);
                reportView.preview();
            }
        }

        // 샘플 1 데이터 불러오기
        function clickButton_1() {
            setSample(gridFields1, gridColumns1, gridData1, gridReportOptions);
        }

        // 샘플 2 데이터 불러오기
        function clickButton_2() {
            const options = {
                ...gridReportOptions,
            };
            options.title.text = '리포트 제목';
            setSample(gridFields2, gridColumns2, gridData2, options);
        }

        // zoomIn
        function clickButton_3() {
            reportView?.zoomIn();
        }

        // zoomOut
        function clickButton_4() {
            reportView?.zoomOut();
        }

        // fitToHeight
        function clickButton_5() {
            reportView?.fitToHeight();
        }

        // fitToPage
        function clickButton_6() {
            reportView?.fitToPage();
        }

        // fitToWidth
        function clickButton_7() {
            reportView?.fitToWidth();
        }

        // PDF
        function clickButton_8() {
            // 폰트 파일을 base64로 변환
            async function base64convert (url, split) {
                const data = await fetch(url);
                const blob = await data.blob();
                
                return new Promise(resolve => {
                    const reader = new FileReader();
                    reader.readAsDataURL(blob);
                    reader.onloadend = () => {
                    const base64data = reader.result;
                    resolve(split ? base64data.split(',')[1] : base64data);
                    }    
                });
            }

            base64convert('/js/pdffonts/NanumGothic.otf', true).then(regularFont => {
                base64convert('/js/pdffonts/NanumGothicBold.otf', true).then(boldFont => {
                    const fonts = [{
                        name: 'regular',
                        content: regularFont,
                        style: 'normal',
                        weight: 'normal',
                    },
                    {
                        name: 'bold',
                        content: boldFont,
                        style: 'normal',
                        weight: 'bold',
                    }];
            
                    if (reportView) {
                        reportView?.exportPdf({fonts, filename: 'sample-pdf-filename.pdf', preview: false});
                    }
                });
            });
        }

        // PNG
        function clickButton_9() {
            reportView?.exportImage({
                type: 'png',
                fileName: 'grid-report-png'
            });
        }

        // JPEG
        function clickButton_10() {
            reportView?.exportImage({
                type: 'jpeg',
                fileName: 'grid-report-jpeg'
            });
        }

        // GIF
        function clickButton_11() {
            reportView?.exportImage({
                type: 'gif',
                fileName: 'grid-report-gif'
            });
        }

        // TIF
        function clickButton_12() {
            const options = { type: 'tif' };
            options.fileName = 'grid-report-tif';
            reportView?.exportImage(options);
        }

        // TIFF
        function clickButton_13() {
            const options = { type: 'tiff' };
            options.tiff = { encoding: 'g4' }; // or 'g3'
            options.fileName = 'grid-report-tiff';
            reportView?.exportImage(options);
        }

        // HWP
        function clickButton_14() {
            reportView?.exportDocument({ type: 'hwp' });
        }

        // DOCX
        function clickButton_15() {
            reportView?.exportDocument({ type: 'docx' });
        }
</script>

</head>

<body>
    <div class="content">
        <div id="realgrid"></div>
        <div class="toolbar">
            <button id="button1">샘플1</button>
            <button id="button2">샘플2</button>
            <hr class="hr">
            <button id="button3">ZoomIn</button>
            <button id="button4">ZoomOut</button>
            <button id="button5">FitToHeight</button>
            <button id="button6">FitToPage</button>
            <button id="button7">FitToWidth</button>
            <hr class="hr">
            <button id="button8">PDF</button>
            <button id="button9">PNG</button>
            <button id="button10">JPEG</button>
            <button id="button11">GIF</button>
            <button id="button12">TIF</button>
            <button id="button13">TIFF</button>
            <button id="button14">HWP</button>
            <button id="button15">DOCX</button>
        </div>
        <div id="realreport"></div>
    </div>
</body>

</html>